<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Legal Authority Access | Eek Mechanical Ltd</title>
  <meta name="description" content="Official legal authority access portal for Eek Mechanical Ltd. Law enforcement, regulatory bodies, court officers, and government agencies." />
  <meta name="keywords" content="legal authority, law enforcement, regulatory access, court documents, government agencies, eek mechanical" />
  <meta property="og:title" content="Legal Authority Access | Eek Mechanical Ltd" />
  <meta property="og:description" content="Secure access portal for legal authorities, law enforcement, and regulatory bodies requiring official information from Eek Mechanical Ltd." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.eek.nz/mjuris" />

  <!-- Security Headers -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com https://www.redditstatic.com https://googleads.g.doubleclick.net; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' https://www.google-analytics.com https://www.redditstatic.com https://pixel-config.reddit.com https://conversions-config.reddit.com https://www.googletagmanager.com https://googleads.g.doubleclick.net https://www.google.com https://www.googleadservices.com https://www.google.hn https://default61ffc6bcd9ce458b8120d32187c377.0d.environment.api.powerplatform.com; frame-src 'self' https://td.doubleclick.net https://www.googletagmanager.com;">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">

  <!-- Reddit Pixel -->
  <script>
    !function(w,d){if(!w.rdt){var p=w.rdt=function(){p.sendEvent?p.sendEvent.apply(p,arguments):p.callQueue.push(arguments)};p.callQueue=[];var t=d.createElement("script");t.src="https://www.redditstatic.com/ads/pixel.js",t.async=!0;var s=d.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}}
    (window,document);
    
    // Extract user data for enhanced tracking
    function getEmailFromForm() {
      const urlParams = new URLSearchParams(window.location.search);
      const emailParam = urlParams.get('email');
      if (emailParam) return emailParam;
      
      const emailInputs = document.querySelectorAll('input[type="email"], input[name*="email"], input[id*="email"]');
      for (let input of emailInputs) {
        if (input.value && input.value.includes('@')) {
          return input.value;
        }
      }
      return null;
    }
    
    function getPhoneFromForm() {
      const urlParams = new URLSearchParams(window.location.search);
      const phoneParam = urlParams.get('phone');
      if (phoneParam) return phoneParam;
      
      const phoneInputs = document.querySelectorAll('input[type="tel"], input[name*="phone"], input[id*="phone"]');
      for (let input of phoneInputs) {
        if (input.value) {
          return input.value;
        }
      }
      return null;
    }
    
    function getUserId() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('uid') || urlParams.get('user_id') || urlParams.get('customer_id');
    }
    
    function getMobileIds() {
      const urlParams = new URLSearchParams(window.location.search);
      return {
        idfa: urlParams.get('idfa'),
        aaid: urlParams.get('aaid')
      };
    }
    
    const mobileIds = getMobileIds();
    const initConfig = {};
    
    const email = getEmailFromForm();
    const phoneNumber = getPhoneFromForm();
    const externalId = getUserId();
    
    if (email) initConfig.email = email;
    if (phoneNumber) initConfig.phoneNumber = phoneNumber;
    if (externalId) initConfig.externalId = externalId;
    if (mobileIds.idfa) initConfig.idfa = mobileIds.idfa;
    if (mobileIds.aaid) initConfig.aaid = mobileIds.aaid;
    
    rdt('init', 'a2_hf16791nsdhx', Object.keys(initConfig).length > 0 ? initConfig : undefined);
    rdt('track', 'PageVisit');
  </script>

  <!-- Google tag (gtag.js) for Google Ads Conversion Tracking -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17084465163"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'AW-17084465163');
    gtag('config', 'G-DQNKF1YLWR');
  </script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "LegalService",
    "name": "Eek Mechanical Legal Authority Portal",
    "description": "Official legal authority access portal for law enforcement, regulatory bodies, and government agencies",
    "url": "https://www.eek.nz/mjuris",
    "parentOrganization": {
      "@type": "LocalBusiness",
      "name": "Eek Mechanical Limited"
    },
    "areaServed": {
      "@type": "Country",
      "name": "New Zealand"
    }
  }
  </script>

  <link rel="icon" type="image/x-icon" href="../favicon.ico">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
      background: #f8f9fa;
      color: #333333;
      line-height: 1.6;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #1e3a5f 0%, #2c5282 100%);
      color: white;
      padding: 40px 0;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .header h1 {
      font-size: 2.5em;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .header .subtitle {
      font-size: 1.2em;
      color: #e1e8f0;
      font-weight: 300;
    }

    /* Authority Warning */
    .authority-warning {
      background: linear-gradient(135deg, #dc3545, #c82333);
      color: white;
      padding: 25px;
      margin: 20px auto;
      border-radius: 8px;
      text-align: center;
      max-width: 800px;
      box-shadow: 0 4px 8px rgba(220,53,69,0.3);
    }

    .authority-warning h2 {
      font-size: 1.6em;
      margin-bottom: 15px;
    }

    .authority-warning p {
      font-size: 1.1em;
      margin-bottom: 10px;
    }

    /* Main Content */
    .section {
      background: white;
      margin: 20px auto;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      max-width: 800px;
    }

    .section-title {
      font-size: 1.8em;
      margin-bottom: 20px;
      color: #1e3a5f;
      font-weight: 600;
    }

    /* Contact Grid */
    .contact-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }

    .contact-card {
      background: #f8f9fa;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      padding: 25px;
      text-align: center;
      transition: all 0.3s ease;
    }

    .contact-card:hover {
      border-color: #1e3a5f;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transform: translateY(-2px);
    }

    .contact-card.priority {
      border-color: #dc3545;
      background: #fff5f5;
    }

    .contact-card.priority:hover {
      border-color: #c82333;
      background: #fff0f0;
    }

    .contact-card h3 {
      color: #1e3a5f;
      font-size: 1.3em;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .contact-card.priority h3 {
      color: #dc3545;
    }

    .contact-card p {
      color: #6c757d;
      margin-bottom: 20px;
      font-size: 0.95em;
    }

    .contact-btn {
      background-color: #1e3a5f;
      color: white;
      text-decoration: none;
      padding: 12px 25px;
      border-radius: 6px;
      font-weight: 500;
      display: inline-block;
      margin: 5px;
      transition: all 0.3s ease;
    }

    .contact-btn:hover {
      background-color: #2c5282;
      transform: translateY(-1px);
    }

    .contact-btn.priority {
      background-color: #dc3545;
    }

    .contact-btn.priority:hover {
      background-color: #c82333;
    }

    /* Company Info */
    .company-info {
      background: #e8f4fd;
      border-left: 4px solid #1e3a5f;
      padding: 20px;
      margin: 30px 0;
      border-radius: 4px;
    }

    .company-info h3 {
      color: #1e3a5f;
      margin-bottom: 15px;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .info-item {
      padding: 10px 0;
    }

    .info-item strong {
      color: #1e3a5f;
      display: block;
      margin-bottom: 5px;
    }

    /* Process Steps */
    .process-section {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 30px;
      margin: 30px 0;
    }

    .process-steps {
      margin: 20px 0;
    }

    .process-step {
      display: flex;
      gap: 20px;
      margin-bottom: 25px;
      padding-bottom: 25px;
      border-bottom: 1px solid #e9ecef;
    }

    .process-step:last-child {
      border-bottom: none;
    }

    .step-number {
      background: #1e3a5f;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      flex-shrink: 0;
    }

    .step-content h4 {
      color: #1e3a5f;
      margin-bottom: 8px;
    }

    .step-content p {
      color: #6c757d;
      font-size: 0.95em;
    }

    /* Legal Notice */
    .legal-notice {
      background: #fff3cd;
      border: 1px solid #ffc107;
      border-radius: 8px;
      padding: 20px;
      margin: 30px 0;
    }

    .legal-notice h4 {
      color: #856404;
      margin-bottom: 10px;
    }

    .legal-notice p {
      color: #856404;
      margin-bottom: 10px;
    }

    /* Footer */
    .footer {
      background: #1e3a5f;
      color: white;
      padding: 30px 0;
      margin-top: 40px;
      text-align: center;
    }

    .footer a {
      color: #b8d4e8;
      text-decoration: none;
      margin: 0 15px;
    }

    .footer a:hover {
      color: #ffffff;
    }

    /* Debug Info */
    .debug-info {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 10px;
      font-size: 12px;
      border-radius: 5px;
      z-index: 9999;
      display: none; /* Change to 'block' to enable debugging */
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .header h1 {
        font-size: 2em;
      }
      
      .contact-grid,
      .info-grid {
        grid-template-columns: 1fr;
      }
      
      .process-step {
        flex-direction: column;
        gap: 10px;
      }
      
      .section {
        margin: 20px 10px;
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <!-- Debug Info Panel -->
  <div class="debug-info" id="debugInfo">
    <div>Page: Legal Authority Portal</div>
    <div>Session ID: <span id="debugSessionId">Loading...</span></div>
    <div>GCLID: <span id="debugGclid">None</span></div>
    <div>Authority Type: <span id="debugAuthorityType">Unknown</span></div>
    <div>IP Country: <span id="debugIPCountry">Unknown</span></div>
  </div>

  <header class="header">
    <div class="container">
      <h1>Legal Authority Access Portal</h1>
      <p class="subtitle">Eek Mechanical Ltd | Official Information Requests</p>
    </div>
  </header>

  <div class="authority-warning">
    <h2>üõ°Ô∏è RESTRICTED ACCESS</h2>
    <p><strong>This portal is exclusively for verified legal authorities, law enforcement, regulatory bodies, and government agencies.</strong></p>
    <p>Unauthorized access or misrepresentation of authority may result in legal action.</p>
    <p>All access attempts are logged and monitored for security purposes.</p>
  </div>

  <section class="section">
    <h2 class="section-title">Company Registration Information</h2>
    
    <div class="company-info">
      <h3>Eek Mechanical Limited - Official Details</h3>
      <div class="info-grid">
        <div class="info-item">
          <strong>Legal Entity Name:</strong>
          Eek Mechanical Ltd
        </div>
        <div class="info-item">
          <strong>Company Number:</strong>
          9365185
        </div>
        <div class="info-item">
          <strong>NZBN:</strong>
          9429053064165
        </div>
        <div class="info-item">
          <strong>Entity Type:</strong>
          Overseas Non-ASIC Company (United Kingdom)
        </div>
        <div class="info-item">
          <strong>Incorporation Date:</strong>
          19 August 2025
        </div>
        <div class="info-item">
          <strong>Status:</strong>
          Registered and Active
        </div>
        <div class="info-item">
          <strong>Principal Place of Business:</strong>
          Suite 14603, Level 1<br>
          6 Johnsonville Road<br>
          Johnsonville, Wellington 6037<br>
          New Zealand
        </div>
        <div class="info-item">
          <strong>Legal Counsel:</strong>
          In-House Legal Department<br>
          Wellington, New Zealand
        </div>
      </div>
    </div>
  </section>

  <section class="section">
    <h2 class="section-title">Official Contact Channels by Authority Type</h2>
    
    <div class="contact-grid">
      <div class="contact-card priority">
        <h3>üö® Emergency Services & Police</h3>
        <p><strong>NZ Police, Fire & Emergency NZ, Ambulance Services</strong><br>
        Emergency investigations, active incidents, immediate response required</p>
        <a href="mailto:clx@eek.nz" class="contact-btn priority" data-track="emergency_law_enforcement" onclick="trackInteraction(this)">üìß clx@eek.nz</a>
        <a href="tel:+6498724612" class="contact-btn priority phone-link" data-track="emergency_call" onclick="trackInteraction(this)">üìû Emergency Line</a>
        <p style="font-size: 0.85em; margin-top: 10px; color: #dc3545;">
          <strong>24/7 Response:</strong> +64 9 872 4612
        </p>
      </div>
      
      <div class="contact-card">
        <h3>üèõÔ∏è Government Agencies</h3>
        <p><strong>WorkSafe NZ, NZTA, Commerce Commission, MBIE</strong><br>
        Regulatory compliance, inspections, official inquiries</p>
        <a href="mailto:comms.apac@eek.nz" class="contact-btn" data-track="government_agency_email" onclick="trackInteraction(this)">üìß comms.apac@eek.nz</a>
        <a href="tel:+6498724612" class="contact-btn phone-link" data-track="government_agency_call" onclick="trackInteraction(this)">üìû Official Line</a>
      </div>
      
      <div class="contact-card">
        <h3>‚öñÔ∏è Court Officers & Legal</h3>
        <p><strong>Court Registrars, Bailiffs, Legal Representatives</strong><br>
        Service of documents, court orders, legal proceedings</p>
        <a href="mailto:legal@eek.nz" class="contact-btn" data-track="court_legal_email" onclick="trackInteraction(this)">üìß legal@eek.nz</a>
        <p style="font-size: 0.85em; margin-top: 10px;">
          <strong>Physical Service Address:</strong><br>
          Suite 14603, Level 1<br>
          6 Johnsonville Road<br>
          Johnsonville, Wellington 6037
        </p>
      </div>
      
      <div class="contact-card">
        <h3>üîç Investigations & Compliance</h3>
        <p><strong>SFO, IRD, Customs, Immigration</strong><br>
        Financial investigations, tax matters, border compliance</p>
        <a href="mailto:legal@eek.nz" class="contact-btn" data-track="investigation_email" onclick="trackInteraction(this)">üìß legal@eek.nz</a>
        <p style="font-size: 0.85em; margin-top: 10px;">
          <strong>Response Time:</strong> 2-3 business days for standard inquiries
        </p>
      </div>
    </div>
  </section>

  <section class="section">
    <h2 class="section-title">Information Request Process</h2>
    
    <div class="process-section">
      <h3>Standard Procedure for Official Requests</h3>
      
      <div class="process-steps">
        <div class="process-step">
          <div class="step-number">1</div>
          <div class="step-content">
            <h4>Authority Verification</h4>
            <p>Provide official identification, warrant number, or agency reference. Include contact details of supervising officer or department head for verification.</p>
          </div>
        </div>
        
        <div class="process-step">
          <div class="step-number">2</div>
          <div class="step-content">
            <h4>Request Specification</h4>
            <p>Clearly specify the information required, relevant dates, case numbers, and legal authority (e.g., search warrant, court order, statutory power).</p>
          </div>
        </div>
        
        <div class="process-step">
          <div class="step-number">3</div>
          <div class="step-content">
            <h4>Legal Review</h4>
            <p>Our legal department will review the request within 24 hours for emergency matters, 2-3 business days for standard requests.</p>
          </div>
        </div>
        
        <div class="process-step">
          <div class="step-number">4</div>
          <div class="step-content">
            <h4>Information Provision</h4>
            <p>Approved requests will be fulfilled promptly. Information may be provided electronically or via secure courier depending on sensitivity.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="section">
    <h2 class="section-title">Available Information Categories</h2>
    
    <div class="info-grid">
      <div class="info-item">
        <strong>üìã Corporate Records</strong>
        Company registration, director information, shareholding structure, registered addresses
      </div>
      <div class="info-item">
        <strong>üìû Customer Service Records</strong>
        Service history, customer communications, billing records, dispute resolution
      </div>
      <div class="info-item">
        <strong>üöó Vehicle Service Data</strong>
        Inspection reports, repair records, parts procurement, technician assignments
      </div>
      <div class="info-item">
        <strong>üíº Employment Records</strong>
        Staff details (subject to privacy laws), work schedules, training records, disciplinary matters
      </div>
      <div class="info-item">
        <strong>üí∞ Financial Information</strong>
        Business transactions, GST records, supplier payments (warrant required for detailed records)
      </div>
      <div class="info-item">
        <strong>üì± Communications Data</strong>
        Call logs, email communications, SMS records (telecommunications warrant required)
      </div>
    </div>
  </section>

  <div class="legal-notice">
    <h4>‚ö†Ô∏è Important Legal Notice</h4>
    <p><strong>Privacy Act 2020 Compliance:</strong> All information requests must comply with New Zealand privacy legislation. Personal information will only be disclosed where legally required or authorized.</p>
    <p><strong>Evidence Act 2006:</strong> Digital evidence will be preserved according to legal standards. Chain of custody documentation will be provided for court proceedings.</p>
    <p><strong>Telecommunications (Interception Capability and Security) Act 2013:</strong> Communications interception requires appropriate judicial authorization.</p>
  </div>

  <footer class="footer">
    <div class="container">
      <p>&copy; 2025 Eek Mechanical Ltd. All rights reserved. | Company No: 9365185 | NZBN: 9429053064165</p>
      <div style="margin-top: 15px;">
        <a href="/legal" data-track="footer_legal_center" onclick="trackInteraction(this)">Legal & Compliance Center</a>
        <a href="/privacy" data-track="footer_privacy" onclick="trackInteraction(this)">Privacy Policy</a>
        <a href="/" data-track="footer_home" onclick="trackInteraction(this)">Main Website</a>
      </div>
    </div>
  </footer>

  <script>
    // === LEGAL AUTHORITY PORTAL TRACKING SYSTEM ===
    console.log('üöÄ === LEGAL AUTHORITY PORTAL INITIALIZED === üöÄ');

    // API Endpoint for tracking interactions (same as More Options)
    const TRACKING_API_URL = "https://default61ffc6bcd9ce458b8120d32187c377.0d.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/2f31c90260554c5a9d6dcffec47bc6c2/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=Ou7iqzZ1YI2PzT_9X-M6PT5iVo2QRboWnFZrO3IBOL4";

    let sessionId = null;
    let gclid = null;
    let utmData = {};
    let authorityType = 'unknown';
    let ipCountry = 'unknown';

    // === SESSION AND TRACKING DATA MANAGEMENT ===
    function initializeTracking() {
      console.log('üìä Initializing legal authority tracking system...');
      
      // Get or create session ID
      sessionId = getOrCreateSessionId();
      
      // Capture GCLID from URL or localStorage
      gclid = getGCLID();
      
      // Capture UTM parameters
      utmData = getUTMData();
      
      // Detect authority type from URL parameters or referrer
      authorityType = detectAuthorityType();
      
      // Detect IP country (placeholder - would need actual IP geolocation)
      ipCountry = detectIPCountry();
      
      // Update debug display
      updateDebugInfo();
      
      // Send page view event
      sendPageViewEvent();
      
      console.log('‚úÖ Legal authority tracking system initialized');
      console.log('üìä Session ID:', sessionId);
      console.log('üìä Authority Type:', authorityType);
      console.log('üìä IP Country:', ipCountry);
    }

    function getOrCreateSessionId() {
      let sid = localStorage.getItem("eek_session_id");
      
      if (!sid) {
        // Try to get from URL parameters (cross-page continuity)
        const urlParams = new URLSearchParams(window.location.search);
        sid = urlParams.get('session_id');
        
        if (sid) {
          localStorage.setItem("eek_session_id", sid);
          console.log('üîÑ Session ID restored from URL');
        } else {
          // Create new session ID
          sid = `mjuris_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
          localStorage.setItem("eek_session_id", sid);
          console.log('üÜï New legal authority session ID created');
        }
      } else {
        console.log('‚úÖ Existing session ID found');
      }
      
      return sid;
    }

    function getGCLID() {
      const urlParams = new URLSearchParams(window.location.search);
      let gclidValue = urlParams.get('gclid');
      
      // If GCLID in URL, store it (30-day persistence)
      if (gclidValue) {
        localStorage.setItem("eek_gclid", gclidValue);
        localStorage.setItem("eek_gclid_timestamp", new Date().toISOString());
        console.log('‚úÖ GCLID captured from URL:', gclidValue);
        return gclidValue;
      }
      
      // Otherwise, try to get stored GCLID
      const storedGclid = localStorage.getItem("eek_gclid");
      const storedTimestamp = localStorage.getItem("eek_gclid_timestamp");
      
      if (storedGclid && storedTimestamp) {
        const thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
        
        if (new Date(storedTimestamp) > thirtyDaysAgo) {
          console.log('üìã Using stored GCLID:', storedGclid);
          return storedGclid;
        } else {
          // GCLID expired
          localStorage.removeItem("eek_gclid");
          localStorage.removeItem("eek_gclid_timestamp");
          console.log('‚ö†Ô∏è GCLID expired and removed');
        }
      }
      
      return null;
    }

    function getUTMData() {
      const urlParams = new URLSearchParams(window.location.search);
      const utm = {};
      const utmParams = ['utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content'];
      
      // Check URL parameters
      utmParams.forEach(param => {
        const value = urlParams.get(param);
        if (value) {
          utm[param] = value;
          // Store for future use
          localStorage.setItem(`eek_${param}`, value);
        }
      });
      
      // Fill in from localStorage if not in URL
      utmParams.forEach(param => {
        if (!utm[param]) {
          const stored = localStorage.getItem(`eek_${param}`);
          if (stored) {
            utm[param] = stored;
          }
        }
      });
      
      return utm;
    }

    function detectAuthorityType() {
      const urlParams = new URLSearchParams(window.location.search);
      const referrer = document.referrer.toLowerCase();
      
      // Check URL parameters for authority type
      const authParam = urlParams.get('authority') || urlParams.get('auth_type');
      if (authParam) {
        return authParam.toLowerCase();
      }
      
      // Check referrer for authority indicators
      if (referrer.includes('police.govt.nz')) return 'police';
      if (referrer.includes('worksafe.govt.nz')) return 'worksafe';
      if (referrer.includes('nzta.govt.nz')) return 'nzta';
      if (referrer.includes('comcom.govt.nz')) return 'commerce_commission';
      if (referrer.includes('ird.govt.nz')) return 'ird';
      if (referrer.includes('justice.govt.nz')) return 'courts';
      if (referrer.includes('.govt.nz')) return 'government';
      if (referrer.includes('law.') || referrer.includes('legal.')) return 'legal';
      
      return 'unknown';
    }

    function detectIPCountry() {
      // Placeholder for IP geolocation
      // In production, this would use a geolocation service
      const urlParams = new URLSearchParams(window.location.search);
      const country = urlParams.get('country') || urlParams.get('ip_country');
      
      return country || 'nz'; // Default to NZ for legal authority portal
    }

    function updateDebugInfo() {
      const sessionIdEl = document.getElementById('debugSessionId');
      const gclidEl = document.getElementById('debugGclid');
      const authorityTypeEl = document.getElementById('debugAuthorityType');
      const ipCountryEl = document.getElementById('debugIPCountry');
      
      if (sessionIdEl) sessionIdEl.textContent = sessionId ? sessionId.substring(0, 20) + '...' : 'None';
      if (gclidEl) gclidEl.textContent = gclid || 'None';
      if (authorityTypeEl) authorityTypeEl.textContent = authorityType;
      if (ipCountryEl) ipCountryEl.textContent = ipCountry.toUpperCase();
    }

    // === EVENT TRACKING ===
    function buildTrackingPayload(eventType, eventAction, additionalData = {}) {
      return {
        eventType: eventType,
        eventAction: eventAction,
        timestamp: new Date().toISOString(),
        sessionId: sessionId,
        gclid: gclid,
        
        // Page context
        page: {
          title: document.title,
          url: window.location.href,
          path: window.location.pathname,
          referrer: document.referrer || null,
          pageType: 'legal_authority_portal'
        },
        
        // Authority-specific data
        authority: {
          type: authorityType,
          ipCountry: ipCountry,
          verified: false // Would be set to true after verification process
        },
        
        // UTM tracking
        utm: utmData,
        
        // Device info
        device: {
          userAgent: navigator.userAgent,
          platform: navigator.platform || null,
          language: navigator.language || null,
          mobile: /Mobi|Android/i.test(navigator.userAgent),
          screen: {
            width: window.screen ? window.screen.width : null,
            height: window.screen ? window.screen.height : null,
            pixelRatio: window.devicePixelRatio || 1
          }
        },
        
        // Security context
        security: {
          restrictedAccess: true,
          portalType: 'legal_authority',
          accessLogged: true
        },
        
        // Source tracking
        source: 'mjuris_portal',
        formVersion: '2.0',
        
        // Additional data
        ...additionalData
      };
    }

    async function sendTrackingEvent(payload) {
      try {
        const response = await fetch(TRACKING_API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload),
          keepalive: true
        });
        
        console.log(`üì° Legal authority event sent: ${payload.eventAction} (Status: ${response.status})`);
        
        // Also send to security log if high-priority event
        if (payload.eventAction.includes('emergency') || payload.eventAction.includes('law_enforcement')) {
          console.log('üîí High-priority legal authority access logged');
        }
        
        return response.ok;
      } catch (error) {
        console.error('‚ùå Legal authority tracking event failed:', error);
        return false;
      }
    }

    function sendPageViewEvent() {
      const payload = buildTrackingPayload('page_view', 'mjuris_portal_access', {
        accessTime: new Date().toISOString(),
        loadTime: Date.now() - performance.navigationStart,
        restrictedPortal: true,
        securityLevel: 'high'
      });
      
      sendTrackingEvent(payload);
    }

    // === INTERACTION TRACKING ===
    function trackInteraction(element) {
      const trackingAction = element.dataset.track;
      const linkUrl = element.href;
      const linkText = element.textContent.trim();
      
      console.log('üëÜ Legal authority interaction tracked:', trackingAction);
      
      // Determine priority level
      const isPriorityContact = element.classList.contains('priority') || 
                               trackingAction.includes('emergency') || 
                               trackingAction.includes('law_enforcement');
      
      // Build event payload
      const payload = buildTrackingPayload('authority_interaction', trackingAction, {
        element: {
          tag: element.tagName.toLowerCase(),
          text: linkText,
          href: linkUrl,
          className: element.className,
          isPriority: isPriorityContact
        },
        interactionType: element.href && element.href.startsWith('tel:') ? 'authority_phone_call' : 
                        element.href && element.href.startsWith('mailto:') ? 'authority_email' : 'authority_link_click',
        securityContext: {
          authorityType: authorityType,
          priorityContact: isPriorityContact,
          accessLogged: true
        }
      });
      
      // Send tracking event
      sendTrackingEvent(payload);
      
      // Analytics tracking
      if (typeof gtag !== 'undefined') {
        gtag('event', trackingAction, {
          event_category: 'Legal Authority Portal',
          event_label: linkText,
          custom_parameter_1: authorityType,
          custom_parameter_2: isPriorityContact ? 'priority' : 'standard',
          value: getEventValue(trackingAction)
        });
        
        // Track high-priority contacts as special conversions
        if (isPriorityContact) {
          gtag('event', 'conversion', {
            send_to: 'AW-17084465163/legal_authority_priority_contact'
          });
        }
      }
      
      // Reddit Pixel tracking for legal authority interactions
      if (typeof rdt !== 'undefined') {
        const eventValue = getEventValue(trackingAction);
        rdt('track', 'Lead', {
          customEventName: 'legal_authority_' + trackingAction,
          conversionId: `mjuris_${Date.now()}`,
          value: eventValue,
          currency: 'NZD',
          eventSource: 'mjuris_portal',
          authorityType: authorityType,
          priority: isPriorityContact ? 'high' : 'standard',
          gclid: gclid
        });
      }
    }

    function getEventValue(action) {
      const valueMap = {
        'emergency_law_enforcement': 100000, // High value - emergency contact
        'emergency_call': 100000,
        'government_agency_email': 50000,
        'government_agency_call': 50000,
        'court_legal_email': 75000,
        'investigation_email': 60000,
        'footer_legal_center': 10000,
        'footer_privacy': 5000,
        'footer_home': 5000
      };
      
      return (valueMap[action] || 20000) / 100; // Convert to dollars
    }

    // === PHONE NUMBER DYNAMIC DISPLAY ===
    function updatePhoneNumbers() {
      // For legal authority portal, always show main number
      // But track if it's from Google Ads traffic
      const showTrackingNumber = !!gclid;
      
      const phoneData = showTrackingNumber ? 
        { tel: 'tel:0800447153', display: '0800 447 153' } :
        { tel: 'tel:+6498724612', display: '+64 9 872 4612' };
      
      // Update all phone links
      document.querySelectorAll('.phone-link').forEach(link => {
        link.href = phoneData.tel;
        // Update display text if it contains phone number
        if (link.textContent.includes('Emergency Line') || link.textContent.includes('Official Line')) {
          // Keep the descriptive text, but could add the number
          // For now, keep as is for legal authority portal
        }
      });
      
      console.log('üìû Legal authority phone numbers updated:', phoneData.display);
    }

    // === SCROLL TRACKING ===
    let scrollTracked = false;
    function trackScroll() {
      if (!scrollTracked && window.scrollY > document.body.scrollHeight * 0.5) {
        scrollTracked = true;
        
        const payload = buildTrackingPayload('authority_engagement', 'scroll_50_percent', {
          scrollDepth: '50%',
          pageHeight: document.body.scrollHeight,
          engagementLevel: 'medium'
        });
        
        sendTrackingEvent(payload);
        
        if (typeof gtag !== 'undefined') {
          gtag('event', 'scroll', {
            event_category: 'Legal Authority Engagement',
            event_label: 'Scrolled 50% of mjuris portal'
          });
        }
      }
    }

    // === SECURITY MONITORING ===
    function monitorSuspiciousActivity() {
      // Monitor for rapid clicks or automated behavior
      let clickCount = 0;
      const startTime = Date.now();
      
      document.addEventListener('click', function() {
        clickCount++;
        
        // If more than 10 clicks in 30 seconds, flag as suspicious
        if (clickCount > 10 && (Date.now() - startTime) < 30000) {
          const payload = buildTrackingPayload('security_alert', 'suspicious_activity', {
            clickCount: clickCount,
            timeWindow: Date.now() - startTime,
            potentialBot: true,
            alertLevel: 'medium'
          });
          
          sendTrackingEvent(payload);
          console.warn('üö® Suspicious activity detected on legal authority portal');
        }
      });
    }

    // === INITIALIZATION ===
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üìÑ Legal Authority Portal loaded');
      
      // Initialize tracking
      initializeTracking();
      
      // Update phone numbers based on traffic source
      updatePhoneNumbers();
      
      // Set up scroll tracking
      window.addEventListener('scroll', trackScroll);
      
      // Initialize security monitoring
      monitorSuspiciousActivity();
      
      // Track initial page engagement
      if (typeof gtag !== 'undefined') {
        gtag('event', 'page_view', {
          page_title: document.title,
          page_location: window.location.href,
          custom_parameter_1: 'legal_authority_portal',
          custom_parameter_2: authorityType,
          gclid: gclid
        });
      }
      
      console.log('‚úÖ Legal Authority Portal initialization complete');
    });

    // === TIME ON PAGE TRACKING ===
    let startTime = Date.now();
    window.addEventListener('beforeunload', function() {
      const timeOnPage = Date.now() - startTime;
      const payload = buildTrackingPayload('authority_engagement', 'session_end', {
        timeOnPage: timeOnPage,
        timeOnPageSeconds: Math.round(timeOnPage / 1000),
        sessionType: 'legal_authority',
        engagementLevel: timeOnPage > 60000 ? 'high' : timeOnPage > 30000 ? 'medium' : 'low'
      });
      
      sendTrackingEvent(payload);
    });

    // === ACCESS LOG FUNCTION FOR AUTHORITIES ===
    function logAuthorityAccess(authorityDetails) {
      const payload = buildTrackingPayload('authority_verification', 'access_logged', {
        authorityDetails: authorityDetails,
        verificationStatus: 'pending',
        accessLevel: 'restricted',
        complianceLogging: true
      });
      
      sendTrackingEvent(payload);
    }

    // Enable debug panel for testing (uncomment to show)
    // document.getElementById('debugInfo').style.display = 'block';
  </script>
</body>
</html>
